<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊäΩÂ•ñÂ∫îÁî® - 10‰∫∫ÂºÄÂ•ñ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-functions-compat.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        memeYellow: '#FFDD00',
                        memePink: '#FF2E93',
                        memeBlue: '#00A3FF',
                        memeGreen: '#00E08E',
                        memePurple: '#9D4EDD',
                        memeBlack: '#121212',
                    },
                    fontFamily: {
                        meme: ['"Comic Sans MS"', '"Comic Neue"', 'cursive'],
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                        'spin': 'spin 1s linear infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        shake: {
                            '10%, 90%': { transform: 'translateX(-1px)' },
                            '20%, 80%': { transform: 'translateX(2px)' },
                            '30%, 50%, 70%': { transform: 'translateX(-4px)' },
                            '40%, 60%': { transform: 'translateX(4px)' },
                        }
                    }
                },
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 3px 3px 0px rgba(0, 0, 0, 0.2);
            }
            .text-shadow-lg {
                text-shadow: 5px 5px 0px rgba(0, 0, 0, 0.2);
            }
            .rotate-random {
                transform: rotate(var(--rotation, -3deg));
            }
            .border-meme {
                border-width: 4px;
                border-style: solid;
                border-color: black;
            }
            .clip-path-slant {
                clip-path: polygon(0 0, 100% 5%, 100% 100%, 0 95%);
            }
        }
    </style>
</head>
<body class="bg-gray-100 font-meme overflow-x-hidden">
    <!-- ÂØºËà™Ê†è -->
    <nav class="sticky top-0 z-50 bg-memeYellow border-b-4 border-black shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="text-4xl animate-pulse-fast">üéØ</div>
                <h1 class="text-2xl md:text-3xl font-bold text-shadow">ÊäΩÂ•ñÂ∫îÁî® <span class="text-memePink">LOTTERY</span></h1>
            </div>
            
            <div class="hidden md:flex items-center space-x-6">
                <a href="#" class="text-lg font-bold hover:text-memePink transition-transform hover:scale-110">È¶ñÈ°µ</a>
                <a href="#how-it-works" class="text-lg font-bold hover:text-memePink transition-transform hover:scale-110">Áé©Ê≥ïËØ¥Êòé</a>
                <a href="#leaderboard" class="text-lg font-bold hover:text-memePink transition-transform hover:scale-110">ÊéíË°åÊ¶ú</a>
                <button id="open-history" class="text-lg font-bold hover:text-memePink transition-transform hover:scale-110">ÂéÜÂè≤ËÆ∞ÂΩï</button>
            </div>
            
            <div class="flex items-center space-x-3">
                <!-- SOL‰ª∑Ê†ºÊòæÁ§∫ -->
                <div class="bg-white px-3 py-1 rounded-lg border-2 border-black shadow-md">
                    <span class="text-sm font-bold text-gray-600">SOL‰ª∑Ê†º: </span>
                    <span id="sol-price" class="text-sm font-bold text-memeBlue">$0.00</span>
                </div>
                <button id="wallet-connect" class="bg-memeBlue hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg border-2 border-black transform hover:scale-105 transition-all shadow-md">
                    <i class="fa fa-wallet mr-2"></i> ËøûÊé•Èí±ÂåÖ
                </button>
                <div id="wallet-info" class="hidden">
                    <span id="wallet-address" class="text-sm text-gray-600 mr-2"></span>
                    <button id="disconnect-wallet" class="text-red-500 hover:text-red-700">
                        <i class="fa fa-sign-out"></i>
                    </button>
                </div>
                <div id="userInfo" class="hidden">
                    <!-- Áî®Êà∑‰ø°ÊÅØÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                </div>
                <div id="myTickets" class="hidden">
                    <!-- ÊàëÁöÑÂ•ñÂà∏‰ø°ÊÅØÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                </div>
                <button class="md:hidden text-2xl">
                    <i class="fa fa-bars"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Ëã±ÈõÑÂå∫Âüü -->
    <header class="relative bg-gradient-to-br from-memePurple via-purple-700 to-memeBlue clip-path-slant pt-16 md:pt-24 pb-32 md:pb-40 overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-full opacity-10">
            <div class="absolute top-10 left-10 text-9xl">üöÄ</div>
            <div class="absolute top-40 right-20 text-8xl">üí∞</div>
            <div class="absolute bottom-20 left-1/3 text-10xl">üéâ</div>
            <div class="absolute bottom-40 right-1/4 text-7xl">üö®</div>
        </div>
        
        <div class="container mx-auto px-4 relative z-10">
            <div class="max-w-3xl mx-auto text-center">
                <h1 class="text-5xl md:text-7xl font-bold mb-6 text-white text-shadow-lg animate-float">
                    10‰∫∫ÂºÄÂ•ñ <span class="text-memeYellow">Ëµ¢Â§ßÂ•ñ</span>!
                </h1>
                <p class="text-xl md:text-2xl text-white mb-8 text-shadow">
                    Êª°10‰∫∫Ëá™Âä®ÂºÄÂ•ñÔºÅ80%‰∏≠Â•ñ + 10%ÂõûË¥≠ + 5%Ëøî‰Ω£ + 4%ÊÄªÂ•ñÊ±† + 1%ÂºÄÂèëËÄÖÔºÅ
                </p>
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <button id="buy-tickets-btn" class="bg-memeYellow hover:bg-yellow-400 text-black font-bold py-3 px-8 rounded-lg border-2 border-black transform hover:scale-105 transition-all shadow-xl text-lg">
                        <i class="fa fa-ticket mr-2"></i> Ë¥≠‰π∞Â•ñÂà∏
                    </button>
                    <button id="open-rules" class="bg-white hover:bg-gray-200 text-memePurple font-bold py-3 px-8 rounded-lg border-2 border-black transform hover:scale-105 transition-all shadow-xl text-lg">
                        <i class="fa fa-info-circle mr-2"></i> Áé©Ê≥ïËØ¥Êòé
                    </button>
                </div>
            </div>
        </div>
        
        <div class="absolute bottom-6 left-0 right-0 flex justify-center pointer-events-none z-20">
            <div class="bg-white px-6 py-3 rounded-full border-4 border-black shadow-lg flex items-center space-x-2 animate-bounce">
                <span class="font-bold">Scroll Down</span>
                <i class="fa fa-chevron-down"></i>
            </div>
        </div>
    </header>

    <!-- Áé©Ê≥ïËØ¥ÊòéÂºπÁ™ó -->
    <div id="rules-modal" class="fixed inset-0 bg-black/50 z-[100] hidden">
        <div class="absolute inset-0 flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-4xl h-[80vh] rounded-2xl border-4 border-black shadow-2xl overflow-hidden flex flex-col">
                <div class="flex items-center justify-between px-4 py-3 border-b-4 border-black bg-memeYellow">
                    <h3 class="text-xl font-extrabold">Áé©Ê≥ïËØ¥Êòé</h3>
                    <button id="close-rules" class="bg-black text-white font-bold px-3 py-1 rounded-lg border-2 border-black">ÂÖ≥Èó≠</button>
                </div>
                <iframe src="rules.html" class="w-full flex-1"></iframe>
            </div>
        </div>
    </div>

    <!-- ÂéÜÂè≤ËÆ∞ÂΩïÂºπÁ™ó -->
    <div id="history-modal" class="fixed inset-0 bg-black/50 z-[100] hidden">
        <div class="absolute inset-0 flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-6xl h-[90vh] rounded-2xl border-4 border-black shadow-2xl overflow-hidden flex flex-col">
                <div class="flex items-center justify-between px-6 py-4 border-b-4 border-black bg-memeYellow">
                    <h3 class="text-xl font-extrabold">ÊäΩÂ•ñÂéÜÂè≤ËÆ∞ÂΩï</h3>
                    <button id="close-history" class="bg-black text-white font-bold px-4 py-2 rounded-lg border-2 border-black">ÂÖ≥Èó≠</button>
                </div>
                <div class="flex-1">
                    <iframe src="history.html" class="w-full h-full border-0"></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- ÂºÄÂ•ñÁªìÊûúÂºπÁ™ó -->
    <div id="draw-result-modal" class="fixed inset-0 bg-black/50 z-[100] hidden">
        <div class="absolute inset-0 flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-4xl max-h-[90vh] rounded-2xl border-4 border-black shadow-2xl overflow-hidden flex flex-col">
                <div class="flex items-center justify-between px-6 py-4 border-b-4 border-black bg-memeYellow">
                    <h3 class="text-xl font-extrabold">üéâ ÂºÄÂ•ñÁªìÊûú</h3>
                    <button id="close-draw-result" class="bg-black text-white font-bold px-4 py-2 rounded-lg border-2 border-black">ÂÖ≥Èó≠</button>
                </div>
                <div id="draw-result-content" class="p-6 overflow-y-auto flex-1">
                    <!-- ÂºÄÂ•ñÁªìÊûúÂÜÖÂÆπÂ∞ÜÈÄöËøáËÑöÊú¨Ê≥®ÂÖ• -->
                </div>
            </div>
        </div>
    </div>

    <!-- ÂΩìÂâçÂ•ñÊ±†Áä∂ÊÄÅ -->
    <section class="pt-20 pb-16 bg-white">
        <div class="container mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold mb-2 text-memeBlack text-shadow">ÂΩìÂâç <span class="text-memePink">ËΩÆÊ¨°</span></h2>
                <p class="text-xl text-gray-600">ËøòÂ∑Æ <span id="remaining-count" class="font-bold text-memeBlue">10</span> ‰∫∫ÂºÄÂ•ñÔºÅ</p>
            </div>
            
            <div class="max-w-4xl mx-auto">
                <!-- ËøõÂ∫¶Êù° -->
                <div class="relative mb-12 md:mb-14">
                    <div class="bg-gray-200 rounded-full h-12 border-4 border-black overflow-hidden">
                        <div id="progress-bar" class="bg-gradient-to-r from-memeGreen to-memeBlue h-full rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <div id="progress-label" class="absolute top-1/2 left-[50%] -translate-x-1/2 -translate-y-1/2 z-10 pointer-events-none">
                        <div class="bg-memeYellow text-black font-bold px-4 py-1 rounded-full border-2 border-black shadow-md transform rotate-[-5deg]">
                            <span id="participant-count">0</span>/10 ‰∫∫
                        </div>
                    </div>
                </div>
                
                <!-- ËØ¶ÁªÜÁªüËÆ° -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-white p-4 rounded-xl border-2 border-black text-center">
                        <div class="text-2xl font-bold text-memeBlue" id="total-amount">0</div>
                        <div class="text-sm text-gray-600">ÊÄªÈáëÈ¢ù (U)</div>
                    </div>
                    <div class="bg-white p-4 rounded-xl border-2 border-black text-center">
                        <div class="text-2xl font-bold text-memeGreen" id="avg-amount">0</div>
                        <div class="text-sm text-gray-600">Âπ≥ÂùáÈáëÈ¢ù (U)</div>
                    </div>
                    <div class="bg-white p-4 rounded-xl border-2 border-black text-center">
                        <div class="text-2xl font-bold text-memePurple" id="max-amount">0</div>
                        <div class="text-sm text-gray-600">ÊúÄÈ´òÈáëÈ¢ù (U)</div>
                    </div>
                    <div class="bg-white p-4 rounded-xl border-2 border-black text-center">
                        <div class="text-2xl font-bold text-memePink" id="min-amount">0</div>
                        <div class="text-sm text-gray-600">ÊúÄ‰ΩéÈáëÈ¢ù (U)</div>
                    </div>
                </div>
                
                <!-- Â•ñÊ±†Âç°Áâá -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-gradient-to-br from-yellow-100 to-memeYellow p-6 rounded-2xl border-meme shadow-xl transform rotate-random hover:scale-105 transition-all">
                        <h3 class="text-2xl font-bold mb-4 text-black">ÂΩìÂâçÂ•ñÊ±†</h3>
                        <div class="flex items-end gap-2">
                            <span id="current-pool" class="text-5xl font-bold text-black">0</span>
                            <span class="text-2xl font-bold text-gray-700 mb-1">U</span>
                        </div>
                        <div class="mt-4 text-lg">
                            <p><i class="fa fa-user mr-2"></i> <span id="current-participants">0</span> ÂèÇ‰∏éËÄÖ</p>
                            <p><i class="fa fa-clock-o mr-2"></i> <span id="pool-status">Á≠âÂæÖ‰∏≠...</span></p>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-blue-100 to-memeBlue p-6 rounded-2xl border-meme shadow-xl transform rotate-random hover:scale-105 transition-all" style="--rotation: 2deg">
                        <h3 class="text-2xl font-bold mb-4 text-white">ÊÄªÂ•ñÊ±†</h3>
                        <div class="flex items-end gap-2">
                            <span id="grand-prize" class="text-5xl font-bold text-white">0</span>
                            <span class="text-2xl font-bold text-blue-100 mb-1">U</span>
                        </div>
                        <div class="mt-4 text-lg text-white">
                            <p><i class="fa fa-ticket mr-2"></i> <span id="total-tickets">0</span> ÊÄªÂ•ñÂà∏</p>
                            <p><i class="fa fa-calendar mr-2"></i> ‰∏ãÊ¨°ÂºÄÂ•ñ: <span id="next-draw">Âë®Êó•</span></p>
                        </div>
                    </div>
                </div>
                
                <!-- ÂèÇ‰∏éËÄÖÂàóË°® -->
                <div class="mt-8 bg-white rounded-2xl border-4 border-black p-6 shadow-xl">
                    <h3 class="text-2xl font-bold mb-4 text-center">ÂΩìÂâçÂèÇ‰∏éËÄÖ</h3>
                    <div id="participants-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3">
                        <!-- ÂèÇ‰∏éËÄÖÂç°ÁâáÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ÂèÇ‰∏éÈÄâÈ°π -->
    <section class="py-16 bg-gray-100">
        <div class="container mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold mb-2 text-memeBlack text-shadow">ÈÄâÊã© <span class="text-memeGreen">Ê°£‰Ωç</span></h2>
                <p class="text-xl text-gray-600">ÈÄâÊã©ÊäïËµÑÊ°£‰ΩçÔºàÊØè10UËé∑Âæó1Âº†Â•ñÂà∏Ôºâ</p>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6 max-w-5xl mx-auto">
                <!-- ÈÄâÈ°πÂç°Áâá -->
                <div class="bg-white rounded-xl border-meme shadow-lg p-6 text-center transform hover:scale-110 transition-all hover:shadow-2xl cursor-pointer hover:animate-shake">
                    <div class="text-4xl mb-4">ü•â</div>
                    <h3 class="text-2xl font-bold mb-2">1U</h3>
                    <p class="text-gray-600 mb-4">0.1 Â•ñÂà∏</p>
                    <button class="buy-ticket-btn w-full bg-gray-200 hover:bg-gray-300 font-bold py-2 px-4 rounded-lg border-2 border-black" data-amount="1">
                        Á´ãÂç≥Ë¥≠‰π∞
                    </button>
                </div>
                
                <div class="bg-white rounded-xl border-meme shadow-lg p-6 text-center transform hover:scale-110 transition-all hover:shadow-2xl cursor-pointer hover:animate-shake">
                    <div class="text-4xl mb-4">ü•à</div>
                    <h3 class="text-2xl font-bold mb-2">2U</h3>
                    <p class="text-gray-600 mb-4">0.2 Â•ñÂà∏</p>
                    <button class="buy-ticket-btn w-full bg-gray-200 hover:bg-gray-300 font-bold py-2 px-4 rounded-lg border-2 border-black" data-amount="2">
                        Á´ãÂç≥Ë¥≠‰π∞
                    </button>
                </div>
                
                <div class="bg-memeYellow rounded-xl border-meme shadow-lg p-6 text-center transform hover:scale-110 transition-all hover:shadow-2xl cursor-pointer hover:animate-shake relative">
                    <div class="absolute -top-4 left-1/2 -translate-x-1/2 bg-memePink text-white font-bold px-3 py-1 rounded-full border-2 border-black transform rotate-[-10deg]">
                        ÁÉ≠Èó®
                    </div>
                    <div class="text-4xl mb-4">üèÜ</div>
                    <h3 class="text-2xl font-bold mb-2">10U</h3>
                    <p class="text-gray-800 mb-4">1 Â•ñÂà∏</p>
                    <button class="buy-ticket-btn w-full bg-black text-white hover:bg-gray-800 font-bold py-2 px-4 rounded-lg border-2 border-black" data-amount="10">
                        Á´ãÂç≥Ë¥≠‰π∞
                    </button>
                </div>
                
                <div class="bg-white rounded-xl border-meme shadow-lg p-6 text-center transform hover:scale-110 transition-all hover:shadow-2xl cursor-pointer hover:animate-shake">
                    <div class="text-4xl mb-4">üíé</div>
                    <h3 class="text-2xl font-bold mb-2">50U</h3>
                    <p class="text-gray-600 mb-4">5 Â•ñÂà∏</p>
                    <button class="buy-ticket-btn w-full bg-gray-200 hover:bg-gray-300 font-bold py-2 px-4 rounded-lg border-2 border-black" data-amount="50">
                        Á´ãÂç≥Ë¥≠‰π∞
                    </button>
                </div>
                
                <div class="bg-white rounded-xl border-meme shadow-lg p-6 text-center transform hover:scale-110 transition-all hover:shadow-2xl cursor-pointer hover:animate-shake">
                    <div class="text-4xl mb-4">üöÄ</div>
                    <h3 class="text-2xl font-bold mb-2">100U</h3>
                    <p class="text-gray-600 mb-4">10 Â•ñÂà∏</p>
                    <button class="buy-ticket-btn w-full bg-gray-200 hover:bg-gray-300 font-bold py-2 px-4 rounded-lg border-2 border-black" data-amount="100">
                        Á´ãÂç≥Ë¥≠‰π∞
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Â¶Ç‰ΩïÂ∑•‰Ωú -->
    <section id="how-it-works" class="py-16 bg-white relative overflow-hidden">
        <div class="absolute -right-20 -top-20 text-9xl opacity-10">ü§î</div>
        <div class="absolute -left-10 bottom-10 text-8xl opacity-10">üìù</div>
        
        <div class="container mx-auto px-4 relative z-10">
            <div class="text-center mb-16">
                <h2 class="text-4xl font-bold mb-2 text-memeBlack text-shadow">HOW IT <span class="text-memeBlue">WORKS</span></h2>
                <p class="text-xl text-gray-600">It's simple, even your grandma could do it (no offense grandma)</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-5xl mx-auto">
                <div class="bg-gray-50 p-6 rounded-2xl border-meme shadow-lg">
                    <div class="w-16 h-16 bg-memePink rounded-full flex items-center justify-center text-white text-2xl mb-6 mx-auto border-4 border-black">
                        1
                    </div>
                    <h3 class="text-2xl font-bold mb-4 text-center">CONNECT WALLET</h3>
                    <p class="text-center">Link your Solana wallet (Phantom, Solflare, whatever floats your boat)</p>
                </div>
                
                <div class="bg-gray-50 p-6 rounded-2xl border-meme shadow-lg">
                    <div class="w-16 h-16 bg-memeBlue rounded-full flex items-center justify-center text-white text-2xl mb-6 mx-auto border-4 border-black">
                        2
                    </div>
                    <h3 class="text-2xl font-bold mb-4 text-center">BUY TICKETS</h3>
                    <p class="text-center">Choose your amount and get tickets. More tickets = better chance (duh)</p>
                </div>
                
                <div class="bg-gray-50 p-6 rounded-2xl border-meme shadow-lg">
                    <div class="w-16 h-16 bg-memeGreen rounded-full flex items-center justify-center text-white text-2xl mb-6 mx-auto border-4 border-black">
                        3
                    </div>
                    <h3 class="text-2xl font-bold mb-4 text-center">WIN (OR NOT)</h3>
                    <p class="text-center">We draw when there's 10 people. 80% to winner, 10% buyback, 5% referrals!</p>
                </div>
            </div>
            
            <!-- ÂàÜÈÖçËØ¥Êòé -->
            <div class="mt-16 max-w-3xl mx-auto bg-gray-100 p-8 rounded-2xl border-meme shadow-lg">
                <h3 class="text-2xl font-bold mb-6 text-center">PRIZE DISTRIBUTION (10u example)</h3>
                
                <div class="space-y-4">
                    <div class="flex items-center">
                        <div class="w-24 font-bold">80u</div>
                        <div class="flex-1 bg-gray-200 h-8 rounded-full overflow-hidden border-2 border-black">
                            <div class="bg-memeGreen h-full rounded-full" style="width: 80%"></div>
                        </div>
                        <div class="w-32 ml-4">Winner</div>
                    </div>
                    
                    <div class="flex items-center">
                        <div class="w-24 font-bold">10u</div>
                        <div class="flex-1 bg-gray-200 h-8 rounded-full overflow-hidden border-2 border-black">
                            <div class="bg-memePurple h-full rounded-full" style="width: 10%"></div>
                        </div>
                        <div class="w-32 ml-4">Buyback</div>
                    </div>
                    
                    <div class="flex items-center">
                        <div class="w-24 font-bold">5u</div>
                        <div class="flex-1 bg-gray-200 h-8 rounded-full overflow-hidden border-2 border-black">
                            <div class="bg-memeBlue h-full rounded-full" style="width: 5%"></div>
                        </div>
                        <div class="w-32 ml-4">Referrals</div>
                    </div>
                    
                    <div class="flex items-center">
                        <div class="w-24 font-bold">4u</div>
                        <div class="flex-1 bg-gray-200 h-8 rounded-full overflow-hidden border-2 border-black">
                            <div class="bg-memeYellow h-full rounded-full" style="width: 4%"></div>
                        </div>
                        <div class="w-32 ml-4">Grand Prize</div>
                    </div>
                    
                    <div class="flex items-center">
                        <div class="w-24 font-bold">1u</div>
                        <div class="flex-1 bg-gray-200 h-8 rounded-full overflow-hidden border-2 border-black">
                            <div class="bg-memePink h-full rounded-full" style="width: 1%"></div>
                        </div>
                        <div class="w-32 ml-4">Developers</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ÊúÄËøëËµ¢ÂÆ∂ -->
    <section id="prizes" class="py-16 bg-gradient-to-br from-gray-900 to-memeBlack text-white">
        <div class="container mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold mb-2 text-shadow">RECENT <span class="text-memeGreen">WINNERS</span></h2>
                <p class="text-xl text-gray-300">These lucky folks cashed out big time!</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-5xl mx-auto">
                <!-- Ëµ¢ÂÆ∂Âç°Áâá -->
                <div class="bg-gray-800 rounded-xl border-2 border-white p-6 transform hover:scale-105 transition-all">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold">@CryptoBro69</h3>
                            <p class="text-gray-400">30 minutes ago</p>
                        </div>
                        <div class="text-3xl">ü•≥</div>
                    </div>
                    <div class="text-3xl font-bold mb-2">80 SOL</div>
                    <p class="text-gray-300 text-sm">
                        <i class="fa fa-hashtag mr-1"></i> Pool #456 ‚Ä¢ 
                        <i class="fa fa-ticket mr-1"></i> 1 Ticket
                    </p>
                </div>
                
                <div class="bg-gray-800 rounded-xl border-2 border-white p-6 transform hover:scale-105 transition-all">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold">@MemeQueen</h3>
                            <p class="text-gray-400">2 hours ago</p>
                        </div>
                        <div class="text-3xl">ü§Ø</div>
                    </div>
                    <div class="text-3xl font-bold mb-2">400 SOL</div>
                    <p class="text-gray-300 text-sm">
                        <i class="fa fa-hashtag mr-1"></i> Pool #455 ‚Ä¢ 
                        <i class="fa fa-ticket mr-1"></i> 5 Tickets
                    </p>
                </div>
                
                <div class="bg-gray-800 rounded-xl border-2 border-white p-6 transform hover:scale-105 transition-all">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold">@HODLer4Life</h3>
                            <p class="text-gray-400">5 hours ago</p>
                        </div>
                        <div class="text-3xl">üöÄ</div>
                    </div>
                    <div class="text-3xl font-bold mb-2">800 SOL</div>
                    <p class="text-gray-300 text-sm">
                        <i class="fa fa-hashtag mr-1"></i> Pool #454 ‚Ä¢ 
                        <i class="fa fa-ticket mr-1"></i> 10 Tickets
                    </p>
                </div>
            </div>
            
            <div class="text-center mt-10">
                <button class="bg-transparent hover:bg-gray-800 text-white font-bold py-2 px-6 rounded-lg border-2 border-white transform hover:scale-105 transition-all">
                    View All Winners
                </button>
            </div>
        </div>
    </section>

    <!-- Êé®ËçêËÆ°Âàí -->
    <section class="py-16 bg-white">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto bg-gradient-to-r from-memePink to-purple-600 rounded-3xl p-8 md:p-12 border-meme shadow-2xl relative overflow-hidden">
                <div class="absolute -right-10 -top-10 text-9xl opacity-20">üí∏</div>
                
                <div class="relative z-10">
                    <h2 class="text-4xl font-bold mb-6 text-white text-shadow text-center">REFER & <span class="text-memeYellow">EARN</span></h2>
                    <p class="text-xl text-white mb-8 text-center">Get 0.5u for each person you refer (when they play)</p>
                    
                    <div class="bg-white p-6 rounded-xl border-2 border-black mb-6">
                        <div class="flex flex-col md:flex-row gap-4">
                            <input id="referral-link-input" type="text" value="" placeholder="ËøûÊé•Èí±ÂåÖÂêéÁîüÊàêÈÇÄËØ∑ÈìæÊé•" class="flex-1 font-meme p-3 border-2 border-gray-300 rounded-lg" readonly>
                            <button id="copy-referral-link-btn" class="bg-memeBlue hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg border-2 border-black transform hover:scale-105 transition-all whitespace-nowrap">
                                Copy Link
                            </button>
                        </div>
                        <div class="mt-4 flex items-center justify-between">
                            <div class="text-white">ÊàëÁöÑËøî‰Ω£‰ΩôÈ¢ù</div>
                            <div id="referral-balance" class="text-2xl font-extrabold text-memeYellow">0</div>
                        </div>
                        <p class="mt-2 text-white/90 text-sm">Ëøî‰Ω£Â∞ÜÁ¥ØËÆ°Âà∞‰ΩôÈ¢ùÔºåÂΩìÁ¥ØËÆ°ËææÂà∞ <strong>1U</strong> Êó∂Ëá™Âä®ÂèëÊîæÊàñÂèØÂèëËµ∑ÊèêÁé∞„ÄÇ</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white/90 p-5 rounded-xl border-2 border-black">
                            <h3 class="text-xl font-bold mb-2">Your Referrals</h3>
                            <p class="text-3xl font-bold">12 People</p>
                        </div>
                        
                        <div class="bg-white/90 p-5 rounded-xl border-2 border-black">
                            <h3 class="text-xl font-bold mb-2">Earnings</h3>
                            <p class="text-3xl font-bold">6.0 SOL</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ÊØèÂë®Â§ßÂ•ñ -->
    <section class="py-16 bg-gray-100">
        <div class="container mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold mb-2 text-memeBlack text-shadow">WEEKLY <span class="text-memePurple">MEGA DRAW</span></h2>
                <p class="text-xl text-gray-600">One lucky winner takes home the entire grand prize!</p>
            </div>
            
            <div class="max-w-3xl mx-auto bg-white rounded-3xl border-meme shadow-xl p-8 text-center relative overflow-hidden">
                <div class="absolute top-0 right-0 text-6xl opacity-10">üíé</div>
                
                <div class="text-5xl font-bold mb-4 text-memePurple">1,245 SOL</div>
                <p class="text-xl mb-6">Total Prize Pool</p>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-gray-100 p-4 rounded-xl border-2 border-black">
                        <p class="text-gray-600">Total Tickets</p>
                        <p class="text-2xl font-bold">12,450</p>
                    </div>
                    
                    <div class="bg-gray-100 p-4 rounded-xl border-2 border-black">
                        <p class="text-gray-600">Your Tickets</p>
                        <p class="text-2xl font-bold">5</p>
                    </div>
                    
                    <div class="bg-gray-100 p-4 rounded-xl border-2 border-black">
                        <p class="text-gray-600">Chance to Win</p>
                        <p class="text-2xl font-bold">0.04%</p>
                    </div>
                    
                    <div class="bg-gray-100 p-4 rounded-xl border-2 border-black">
                        <p class="text-gray-600">Draw In</p>
                        <p class="text-2xl font-bold">3d 4h</p>
                    </div>
                </div>
                
                <button class="bg-memePurple hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-lg border-2 border-black transform hover:scale-105 transition-all shadow-lg text-lg">
                    Get More Tickets
                </button>
            </div>
        </div>
    </section>

    <!-- È°µËÑö -->
    <footer class="bg-memeBlack text-white py-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <div class="flex items-center space-x-2 mb-4">
                        <div class="text-3xl">üöÄ</div>
                        <h2 class="text-2xl font-bold">MOONSHOT <span class="text-memePink">LOTTERY</span></h2>
                    </div>
                    <p class="text-gray-400">The most meme-tastic lottery on Solana. Win big or go home!</p>
                </div>
                
                <div>
                    <h3 class="text-xl font-bold mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white">Home</a></li>
                        <li><a href="#how-it-works" class="text-gray-400 hover:text-white">How It Works</a></li>
                        <li><a href="#prizes" class="text-gray-400 hover:text-white">Prizes</a></li>
                        <li><a href="#leaderboard" class="text-gray-400 hover:text-white">Leaderboard</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-xl font-bold mb-4">Legal</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white">Terms of Service</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Disclaimer</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-xl font-bold mb-4">Connect</h3>
                    <div class="flex space-x-4 mb-4">
                        <a href="#" class="text-2xl hover:text-memePink transition-colors"><i class="fa fa-twitter"></i></a>
                        <a href="#" class="text-2xl hover:text-memePink transition-colors"><i class="fa fa-telegram"></i></a>
                        <a href="#" class="text-2xl hover:text-memePink transition-colors"><i class="fa fa-discord"></i></a>
                        <a href="#" class="text-2xl hover:text-memePink transition-colors"><i class="fa fa-reddit"></i></a>
                    </div>
                    <button id="footer-wallet-connect" class="bg-memeBlue hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg border-2 border-white transform hover:scale-105 transition-all">
                        <i class="fa fa-wallet mr-2"></i> ËøûÊé•Èí±ÂåÖ
                    </button>
                </div>
            </div>
            
            <div class="border-t border-gray-800 pt-8 text-center text-gray-500">
                <p>¬© 2023 Moonshot Lottery. This is a meme project for entertainment purposes only. Don't spend money you can't afford to lose!</p>
            </div>
        </div>
    </footer>

    <!-- ÈÄöÁü•Âå∫Âüü -->
    <div id="notification" class="fixed top-4 right-4 z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg p-4 max-w-sm border-2 border-black">
            <div class="flex items-center">
                <div id="notification-icon" class="mr-3"></div>
                <div>
                    <p id="notification-message" class="text-sm font-medium"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Âä†ËΩΩÈÅÆÁΩ© -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 border-2 border-black">
            <div class="flex items-center">
                <div class="animate-spin w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full mr-3"></div>
                <span id="loading-text">Â§ÑÁêÜ‰∏≠...</span>
            </div>
        </div>
    </div>

    <!-- Ê®°ÊÄÅÊ°Ü (ÈªòËÆ§ÈöêËóè) -->
    <div id="wallet-modal" class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-2xl border-4 border-black p-8 max-w-md w-full mx-4 transform transition-all">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">ËøûÊé•Èí±ÂåÖ</h3>
                <button id="close-modal" class="text-2xl">&times;</button>
            </div>
            
            <div class="space-y-4">
                <button id="phantom-connect" class="w-full flex items-center justify-center gap-3 bg-gray-100 hover:bg-gray-200 font-bold py-3 px-4 rounded-lg border-2 border-black">
                    <img src="https://picsum.photos/id/1/40/40" alt="Phantom Wallet logo" class="w-8 h-8">
                    Phantom
                </button>
                
                <button id="solflare-connect" class="w-full flex items-center justify-center gap-3 bg-gray-100 hover:bg-gray-200 font-bold py-3 px-4 rounded-lg border-2 border-black">
                    <img src="https://picsum.photos/id/2/40/40" alt="Solflare Wallet logo" class="w-8 h-8">
                    Solflare
                </button>
                
                <button id="coinbase-connect" class="w-full flex items-center justify-center gap-3 bg-gray-100 hover:bg-gray-200 font-bold py-3 px-4 rounded-lg border-2 border-black">
                    <img src="https://picsum.photos/id/3/40/40" alt="Coinbase Wallet logo" class="w-8 h-8">
                    Coinbase Wallet
                </button>
            </div>
        </div>
    </div>

    <script>
        // Firebase ÈÖçÁΩÆ
        const firebaseConfig = {
            apiKey: "AIzaSyA5Z5ieEbAcfQX0kxGSn9ldGXhzvAwx_8M",
            authDomain: "chat-294cc.firebaseapp.com",
            databaseURL: "https://chat-294cc-default-rtdb.firebaseio.com",
            projectId: "chat-294cc",
            storageBucket: "chat-294cc.appspot.com",
            messagingSenderId: "913615304269",
            appId: "1:913615304269:web:0274ffaccb8e6b678e4e04",
            measurementId: "G-SJR9NDW86B"
        };

        // ÂàùÂßãÂåñ Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // ÂêØÁî®ÂåøÂêçËÆ§ËØÅ‰ª•Ëß£ÂÜ≥ÊùÉÈôêÈóÆÈ¢ò
        auth.signInAnonymously()
            .then(() => {
                console.log('ÂåøÂêçËÆ§ËØÅÊàêÂäü');
            })
            .catch((error) => {
                console.error('ÂåøÂêçËÆ§ËØÅÂ§±Ë¥•:', error);
            });

        // Á°Æ‰øùÂÜôÂÖ•ÂâçÂ∑≤ÂÆåÊàêËÆ§ËØÅ
        async function ensureAuth() {
            if (auth.currentUser) return auth.currentUser;
            return await new Promise(async (resolve) => {
                const unsubscribe = auth.onAuthStateChanged((user) => {
                    if (user) {
                        unsubscribe();
                        resolve(user);
                    }
                });
                try { await auth.signInAnonymously(); } catch (e) {}
            });
        }

        // Solana ËøûÊé• - ‰ΩøÁî®Êõ¥ÂèØÈù†ÁöÑ RPC Á´ØÁÇπ
        const connection = new solanaWeb3.Connection('https://small-holy-forest.solana-mainnet.quiknode.pro/b59315ea187b3de1b3542c5c25d7f2d5b5410ff4/');
        let wallet = null;
        let currentUser = null;
        let currentRound = null;
        let currentSolPrice = 1; // ÈªòËÆ§ SOL ‰ª∑Ê†ºÔºåÂ∞ÜÂú®ÂàùÂßãÂåñÊó∂Êõ¥Êñ∞
        let referralReferrer = null; // ÂΩìÂâçËÆøÈóÆÊù•Ê∫êÊé®Ëçê‰∫∫Âú∞ÂùÄ

        // Ëé∑Âèñ SOL ‰ª∑Ê†º
        async function fetchSolPrice() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=usd');
                const data = await response.json();
                if (data.solana && data.solana.usd) {
                    currentSolPrice = data.solana.usd;
                    console.log('ÂΩìÂâç SOL ‰ª∑Ê†º:', currentSolPrice, 'USD');
                    updateSolPriceDisplay();
                    return currentSolPrice;
                } else {
                    console.warn('Êó†Ê≥ïËé∑Âèñ SOL ‰ª∑Ê†ºÔºå‰ΩøÁî®ÈªòËÆ§‰ª∑Ê†º 1 USD');
                    currentSolPrice = 1;
                    updateSolPriceDisplay();
                    return 1;
                }
            } catch (error) {
                console.error('Ëé∑Âèñ SOL ‰ª∑Ê†ºÂ§±Ë¥•:', error);
                currentSolPrice = 1;
                updateSolPriceDisplay();
                return 1;
            }
        }

        // Êõ¥Êñ∞ SOL ‰ª∑Ê†ºÊòæÁ§∫
        function updateSolPriceDisplay() {
            const solPriceElement = document.getElementById('sol-price');
            if (solPriceElement) {
                solPriceElement.textContent = `$${currentSolPrice.toFixed(2)}`;
                // Â¶ÇÊûú‰ª∑Ê†ºËé∑ÂèñÂ§±Ë¥•ÔºåÊòæÁ§∫Ë≠¶ÂëäÊ†∑Âºè
                if (currentSolPrice === 1) {
                    solPriceElement.classList.add('text-red-500');
                    solPriceElement.title = '‰ª∑Ê†ºËé∑ÂèñÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§‰ª∑Ê†º';
                } else {
                    solPriceElement.classList.remove('text-red-500');
                    solPriceElement.title = '';
                }
            }
        }

        // Â∞Ü U ÈáëÈ¢ùËΩ¨Êç¢‰∏∫ SOL lamports
        function convertUToLamports(uAmount) {
            return Math.floor(uAmount * solanaWeb3.LAMPORTS_PER_SOL / currentSolPrice);
        }

        // DOM ÂÖÉÁ¥†
        const connectWalletBtn = document.getElementById('wallet-connect');
        const walletInfo = document.getElementById('wallet-info');
        const walletAddress = document.getElementById('wallet-address');
        const disconnectWalletBtn = document.getElementById('disconnect-wallet');
        const buyTicketsBtn = document.getElementById('buy-tickets-btn');
        const notification = document.getElementById('notification');
        const notificationMessage = document.getElementById('notification-message');
        const notificationIcon = document.getElementById('notification-icon');
        const loadingOverlay = document.getElementById('loading-overlay');
        const loadingText = document.getElementById('loading-text');
        const walletModal = document.getElementById('wallet-modal');
        const closeModal = document.getElementById('close-modal');
        const phantomConnect = document.getElementById('phantom-connect');
        const solflareConnect = document.getElementById('solflare-connect');
        const coinbaseConnect = document.getElementById('coinbase-connect');
        const drawResultModal = document.getElementById('draw-result-modal');
        const closeDrawResult = document.getElementById('close-draw-result');
        const drawResultContent = document.getElementById('draw-result-content');
        const referralLinkInput = document.getElementById('referral-link-input');
        const copyReferralLinkBtn = document.getElementById('copy-referral-link-btn');
        const referralBalanceEl = document.getElementById('referral-balance');

        // Â∑•ÂÖ∑ÂáΩÊï∞
        function showNotification(message, type = 'info') {
            notificationMessage.textContent = message;
            notificationIcon.innerHTML = type === 'success' ? 
                '<i class="fa fa-check-circle text-green-500 text-xl"></i>' :
                type === 'error' ? 
                '<i class="fa fa-exclamation-circle text-red-500 text-xl"></i>' :
                '<i class="fa fa-info-circle text-blue-500 text-xl"></i>';
            notification.classList.remove('hidden');
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }

        // ËΩÆÊ¨°ÁõëÂê¨ÂèñÊ∂àÂô®‰∏éÂ∑≤Â±ïÁ§∫Ê†áËÆ∞ÔºåÈÅøÂÖçÈáçÂ§çÂºπÁ™ó
        let activeRoundUnsubscribe = null;
        let lastResultShownRoundId = null;

        function showLoading(text = 'Â§ÑÁêÜ‰∏≠...') {
            loadingText.textContent = text;
            loadingOverlay.classList.remove('hidden');
        }

        function hideLoading() {
            loadingOverlay.classList.add('hidden');
        }

        function updateWalletUI() {
            if (wallet && wallet.publicKey) {
                const address = wallet.publicKey.toString();
                walletAddress.textContent = `${address.slice(0, 4)}...${address.slice(-4)}`;
                connectWalletBtn.classList.add('hidden');
                walletInfo.classList.remove('hidden');
                buyTicketsBtn.classList.remove('hidden');
                // ÁîüÊàêÈÇÄËØ∑ÈìæÊé•
                if (referralLinkInput) {
                    const url = new URL(window.location.href);
                    url.searchParams.set('ref', address);
                    referralLinkInput.value = url.toString();
                }
            } else {
                connectWalletBtn.classList.remove('hidden');
                walletInfo.classList.add('hidden');
                buyTicketsBtn.classList.add('hidden');
                if (referralLinkInput) referralLinkInput.value = '';
            }
        }
        
        function updateRoundInfo(round) {
            if (round) {
                const participants = round.participants || [];
                const participantCount = participants.length;
                const totalAmount = round.totalAmount || 0;
                const status = round.status || 'active';
                const remaining = Math.max(0, 10 - participantCount);

                // Âü∫Á°Ä‰ø°ÊÅØ
                const participantCountElement = document.getElementById('participant-count');
                const remainingCountElement = document.getElementById('remaining-count');
                const currentPoolElement = document.getElementById('current-pool');
                const currentParticipantsElement = document.getElementById('current-participants');
                const poolStatusElement = document.getElementById('pool-status');
                const progressBarElement = document.getElementById('progress-bar');
                const progressLabelElement = document.getElementById('progress-label');

                if (participantCountElement) participantCountElement.textContent = participantCount;
                if (remainingCountElement) remainingCountElement.textContent = remaining;
                if (currentPoolElement) currentPoolElement.textContent = totalAmount;
                if (currentParticipantsElement) currentParticipantsElement.textContent = participantCount;
                if (poolStatusElement) poolStatusElement.textContent = status === 'active' ? 'ËøõË°å‰∏≠...' : 'Â∑≤ÁªìÊùü';

                // ËøõÂ∫¶Êù°ÔºàÂü∫‰∫é‰∫∫Êï∞Ôºâ
                const progress = Math.min(participantCount * 10, 100);
                if (progressBarElement) progressBarElement.style.width = `${progress}%`;
                
                // Êõ¥Êñ∞ËøõÂ∫¶Ê†áÁ≠æ‰ΩçÁΩÆ
                if (progressLabelElement && progress > 0) {
                    progressLabelElement.style.left = `${Math.min(progress, 90)}%`;
                }

                // ËØ¶ÁªÜÁªüËÆ°‰ø°ÊÅØ
                const totalAmountElement = document.getElementById('total-amount');
                const avgAmountElement = document.getElementById('avg-amount');
                const maxAmountElement = document.getElementById('max-amount');
                const minAmountElement = document.getElementById('min-amount');

                if (participants.length > 0) {
                    const amounts = participants.map(p => p.amount || 0);
                    const avgAmount = totalAmount / participantCount;
                    const maxAmount = Math.max(...amounts);
                    const minAmount = Math.min(...amounts);

                    if (totalAmountElement) totalAmountElement.textContent = totalAmount;
                    if (avgAmountElement) avgAmountElement.textContent = avgAmount.toFixed(1);
                    if (maxAmountElement) maxAmountElement.textContent = maxAmount;
                    if (minAmountElement) minAmountElement.textContent = minAmount;
                } else {
                    if (totalAmountElement) totalAmountElement.textContent = '0';
                    if (avgAmountElement) avgAmountElement.textContent = '0';
                    if (maxAmountElement) maxAmountElement.textContent = '0';
                    if (minAmountElement) minAmountElement.textContent = '0';
                }

                // Êõ¥Êñ∞ÂèÇ‰∏éËÄÖÂàóË°®
                updateParticipantsList(participants);
            }
        }

        // Êõ¥Êñ∞ÂèÇ‰∏éËÄÖÂàóË°®
        function updateParticipantsList(participants) {
            const participantsList = document.getElementById('participants-list');
            
            if (participants.length === 0) {
                participantsList.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">ÊöÇÊó†ÂèÇ‰∏éËÄÖ</div>';
                return;
            }

            const participantsHTML = participants.map((participant, index) => {
                const walletAddress = participant.walletAddress || '';
                const shortAddress = walletAddress ? `${walletAddress.slice(0, 4)}...${walletAddress.slice(-4)}` : 'Êú™Áü•';
                const amount = participant.amount || 0;
                const timestamp = participant.timestamp ? new Date(participant.timestamp.toDate()).toLocaleTimeString() : '';
                
                // Ê†πÊçÆÈáëÈ¢ùÈÄâÊã©‰∏çÂêåÁöÑÂõæÊ†áÂíåÈ¢úËâ≤
                let icon = 'üë§';
                let bgColor = 'bg-gray-100';
                let textColor = 'text-gray-800';
                
                if (amount >= 100) {
                    icon = 'üöÄ';
                    bgColor = 'bg-red-100';
                    textColor = 'text-red-800';
                } else if (amount >= 50) {
                    icon = 'üíé';
                    bgColor = 'bg-purple-100';
                    textColor = 'text-purple-800';
                } else if (amount >= 10) {
                    icon = 'üèÜ';
                    bgColor = 'bg-yellow-100';
                    textColor = 'text-yellow-800';
                } else if (amount >= 5) {
                    icon = 'ü•à';
                    bgColor = 'bg-blue-100';
                    textColor = 'text-blue-800';
                } else {
                    icon = 'ü•â';
                    bgColor = 'bg-green-100';
                    textColor = 'text-green-800';
                }

                return `
                    <div class="${bgColor} p-3 rounded-lg border-2 border-black text-center transform hover:scale-105 transition-all">
                        <div class="text-2xl mb-2">${icon}</div>
                        <div class="font-bold ${textColor} text-lg">${amount}U</div>
                        <div class="text-xs text-gray-600 mb-1">${shortAddress}</div>
                        <div class="text-xs text-gray-500">${timestamp}</div>
                    </div>
                `;
            }).join('');

            participantsList.innerHTML = participantsHTML;
        }

        // ÊòæÁ§∫ÂºÄÂ•ñÁªìÊûúÂºπÁ™óÔºàÂ§çÁî®ÂéÜÂè≤ËÆ∞ÂΩïËØ¶ÊÉÖÊ†∑ÂºèÔºâ
        function showDrawResult(round) {
            if (!round) return;
            const winner = round.winner;
            const participants = Array.isArray(round.participants) ? round.participants : [];

            const winnerBlock = winner ? `
                <div class="bg-memeYellow p-4 rounded-lg border-2 border-black mb-4">
                    <h4 class="font-bold text-lg mb-2">üèÜ ‰∏≠Â•ñËÄÖ</h4>
                    <div class="space-y-1 text-sm">
                        <div><strong>Èí±ÂåÖÂú∞ÂùÄ:</strong> ${winner.walletAddress || '-'}</div>
                        <div><strong>Áî®Êà∑ID:</strong> ${winner.userId || '-'}</div>
                        <div><strong>ÂèÇ‰∏éÈáëÈ¢ù:</strong> ${winner.amount || 0}U</div>
                        <div><strong>ÂèÇ‰∏éÊó∂Èó¥:</strong> ${winner.timestamp ? new Date(winner.timestamp.toDate()).toLocaleString() : 'Êú™Áü•'}</div>
                    </div>
                </div>
            ` : '';

            const participantsList = participants.length > 0 ? participants.map((p, idx) => `
                <div class="flex justify-between items-center py-2 border-b border-gray-200 ${winner && p.walletAddress === winner.walletAddress ? 'bg-memeYellow' : ''}">
                    <div class="flex items-center space-x-3">
                        <span class="text-sm font-bold">#${idx + 1}</span>
                        <div>
                            <div class="text-sm font-medium">${p.walletAddress || '-'}</div>
                            <div class="text-xs text-gray-500">${p.timestamp ? new Date(p.timestamp.toDate()).toLocaleString() : 'Êú™Áü•'}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-bold">${p.amount || 0}U</div>
                        ${winner && p.walletAddress === winner.walletAddress ? '<span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">üèÜ ‰∏≠Â•ñ</span>' : ''}
                    </div>
                </div>
            `).join('') : '<p class="text-gray-500">ÊöÇÊó†ÂèÇ‰∏éËÄÖ</p>';

            drawResultContent.innerHTML = `
                <div class="space-y-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-bold text-lg mb-2">ËΩÆÊ¨°‰ø°ÊÅØ</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div><strong>ËΩÆÊ¨°ID:</strong> ${round.id}</div>
                            <div><strong>Áä∂ÊÄÅ:</strong> Â∑≤ÂÆåÊàê</div>
                            <div><strong>ÊÄªÈáëÈ¢ù:</strong> ${round.totalAmount || 0}U</div>
                            <div><strong>‰∏≠Â•ñÈáëÈ¢ù:</strong> ${round.prizeAmount || 0}U</div>
                            <div><strong>ÂõûË¥≠ÈáëÈ¢ù:</strong> ${round.buybackAmount || 0}U</div>
                            <div><strong>Êé®ËçêËøî‰Ω£:</strong> ${round.referralAmount || 0}U</div>
                            <div><strong>ÊÄªÂ•ñÊ±†:</strong> ${round.grandPrizeAmount || 0}U</div>
                            <div><strong>ÂºÄÂèëËÄÖ:</strong> ${round.developerAmount || 0}U</div>
                        </div>
                    </div>
                    ${winnerBlock}
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-bold text-lg mb-2">ÂèÇ‰∏éËÄÖÂàóË°®Ôºà${participants.length}‰∫∫Ôºâ</h4>
                        <div class="max-h-60 overflow-y-auto">
                            ${participantsList}
                        </div>
                    </div>
                </div>
            `;

            drawResultModal.classList.remove('hidden');
        }

        // ÁõëÂê¨ÂΩìÂâçÊ¥ªÂä®ËΩÆÊ¨°ÁöÑÁä∂ÊÄÅÂèòÂåñÔºàÂΩìÂèò‰∏∫ completed ‰∏îÊúâ winner Êó∂ÂºπÁ™óÔºâ
        function attachRoundListener(roundId) {
            if (!roundId) return;
            try { if (typeof activeRoundUnsubscribe === 'function') activeRoundUnsubscribe(); } catch (_) {}

            activeRoundUnsubscribe = db.collection('rounds').doc(roundId).onSnapshot((doc) => {
                if (!doc.exists) return;
                const data = doc.data();
                // ‰ªÖÂΩìÊú¨ËΩÆÈ¶ñÊ¨°ÂÆåÊàêÊó∂Â±ïÁ§∫
                if (data && data.status === 'completed' && data.winner && lastResultShownRoundId !== doc.id) {
                    lastResultShownRoundId = doc.id;
                    showDrawResult({ id: doc.id, ...data });
                }
            });
        }

        function updateUserInfo() {
            const userInfo = document.getElementById('userInfo');
            if (userInfo) {
                if (currentUser) {
                    userInfo.innerHTML = `
                        <div>
                            <span class="text-gray-600">Èí±ÂåÖÂú∞ÂùÄ:</span>
                            <p class="text-sm font-mono break-all">${currentUser.walletAddress}</p>
                        </div>
                        <div>
                            <span class="text-gray-600">ÊàëÁöÑÂ•ñÂà∏:</span>
                            <p class="font-semibold">${currentUser.ticketCount || 0} Âº†</p>
                        </div>
                    `;
                } else {
                    userInfo.innerHTML = '<p class="text-gray-500">Êú™ËøûÊé•Èí±ÂåÖ</p>';
                }
            }
        }

        // Èí±ÂåÖËøûÊé•
        async function connectWallet(walletType = 'phantom') {
            try {
                showLoading('ËøûÊé•Èí±ÂåÖ‰∏≠...');
                
                let walletProvider;
                
                switch(walletType) {
                    case 'phantom':
                        if (!window.solana || !window.solana.isPhantom) {
                            showNotification('ËØ∑ÂÖàÂÆâË£Ö Phantom Èí±ÂåÖ', 'error');
                            hideLoading();
                            return;
                        }
                        walletProvider = window.solana;
                        break;
                    case 'solflare':
                        if (!window.solflare) {
                            showNotification('ËØ∑ÂÖàÂÆâË£Ö Solflare Èí±ÂåÖ', 'error');
                            hideLoading();
                            return;
                        }
                        walletProvider = window.solflare;
                        break;
                    case 'coinbase':
                        if (!window.coinbaseSolana) {
                            showNotification('ËØ∑ÂÖàÂÆâË£Ö Coinbase Èí±ÂåÖ', 'error');
                            hideLoading();
                            return;
                        }
                        walletProvider = window.coinbaseSolana;
                        break;
                    default:
                        showNotification('‰∏çÊîØÊåÅÁöÑÈí±ÂåÖÁ±ªÂûã', 'error');
                        hideLoading();
                        return;
                }

                // ËøûÊé•Èí±ÂåÖ
                const response = await walletProvider.connect();
                wallet = walletProvider;
                
                // Á°Æ‰øùÂåøÂêçËÆ§ËØÅÂ∑≤Â∞±Áª™
                await ensureAuth();

                // ‰ΩøÁî®Èí±ÂåÖÂú∞ÂùÄ‰Ωú‰∏∫Áî®Êà∑ID
                const walletAddress = response.publicKey.toString();
                
                // ÂàõÂª∫ÊàñËé∑ÂèñÁî®Êà∑‰ø°ÊÅØÔºà‰∏ç‰æùËµñFirebase AuthÔºâ
                currentUser = {
                    uid: walletAddress,
                    walletAddress: walletAddress
                };

                // Â∞ùËØïÂàõÂª∫Áî®Êà∑ËÆ∞ÂΩïÔºàÂ¶ÇÊûúÂ§±Ë¥•‰πü‰∏ç‰ºöÈòªÊ≠¢ËøûÊé•Ôºâ
                try {
                    const userRef = db.collection('users').doc(walletAddress);
                    await userRef.set({
                        walletAddress: walletAddress,
                        createdAt: new Date(),
                        referralCode: Math.random().toString(36).substring(2, 8).toUpperCase(),
                    }, { merge: true });
                } catch (firebaseError) {
                    console.warn('Êó†Ê≥ïÂàõÂª∫Áî®Êà∑ËÆ∞ÂΩïÔºå‰ΩÜÈí±ÂåÖËøûÊé•ÊàêÂäü:', firebaseError);
                }

                updateWalletUI();
                updateUserInfo();
                loadCurrentRound();
                loadUserTickets();
                loadPoolInfo();
                showNotification('Èí±ÂåÖËøûÊé•ÊàêÂäüÔºÅ', 'success');
                walletModal.classList.add('hidden');
                
            } catch (error) {
                console.error('ËøûÊé•Èí±ÂåÖÂ§±Ë¥•:', error);
                showNotification('ËøûÊé•Èí±ÂåÖÂ§±Ë¥•ÔºåËØ∑ÈáçËØï', 'error');
            } finally {
                hideLoading();
            }
        }

        // Êñ≠ÂºÄÈí±ÂåÖËøûÊé•
        function disconnectWallet() {
            if (wallet) {
                wallet.disconnect();
                wallet = null;
                currentUser = null;
                updateWalletUI();
                updateUserInfo();
                showNotification('Èí±ÂåÖÂ∑≤Êñ≠ÂºÄËøûÊé•', 'info');
            }
        }

        // Âä†ËΩΩÂΩìÂâçËΩÆÊ¨°
        async function loadCurrentRound() {
            try {
                const roundsQuery = db.collection('rounds')
                    .where('status', '==', 'active')
                    .orderBy('createdAt', 'desc')
                    .limit(1);
                
                const snapshot = await roundsQuery.get();
                
                if (!snapshot.empty) {
                    const round = snapshot.docs[0];
                    currentRound = {
                        id: round.id,
                        ...round.data()
                    };
                } else {
                    // Êó†ÊùÉÈôêÂàõÂª∫ËΩÆÊ¨°Êó∂Ôºå‰ªÖÊú¨Âú∞Âç†‰ΩçÔºå‰∏çËøõË°åÂÜôÂÖ•
                    currentRound = {
                        id: null,
                        status: 'active',
                        level: 1,
                        participants: [],
                        totalAmount: 0,
                    };
                }
                
                updateRoundInfo(currentRound);
                
            } catch (error) {
                console.error('Âä†ËΩΩËΩÆÊ¨°Â§±Ë¥•:', error);
                showNotification('Âä†ËΩΩËΩÆÊ¨°Â§±Ë¥•', 'error');
            }
        }

        // Âä†ËΩΩÁî®Êà∑Â•ñÂà∏
        async function loadUserTickets() {
            if (!currentUser) return;
            
            try {
                const ticketsQuery = db.collection('tickets')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .limit(10);
                
                const snapshot = await ticketsQuery.get();
                const tickets = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                const myTickets = document.getElementById('myTickets');
                if (myTickets) {
                    if (tickets.length > 0) {
                        myTickets.innerHTML = tickets.map(ticket => `
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                                <div>
                                    <div class="font-semibold">${ticket.amount}U</div>
                                    <div class="text-sm text-gray-600">
                                        ${new Date(ticket.createdAt.toDate()).toLocaleDateString()}
                                    </div>
                                </div>
                                <div class="text-sm text-gray-500">
                                    ${ticket.status || 'ÂæÖÂºÄÂ•ñ'}
                                </div>
                            </div>
                        `).join('');
                    } else {
                        myTickets.innerHTML = '<p class="text-gray-500">ÊöÇÊó†Â•ñÂà∏</p>';
                    }
                }
                
                // Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØ‰∏≠ÁöÑÂ•ñÂà∏Êï∞Èáè
                if (currentUser) {
                    currentUser.ticketCount = tickets.length;
                    updateUserInfo();
                }
                // Âà∑Êñ∞Ëøî‰Ω£‰ΩôÈ¢ùÊòæÁ§∫
                try {
                    if (typeof firebase !== 'undefined' && firebase.functions && wallet && wallet.publicKey) {
                        const getBalance = firebase.app().functions().httpsCallable('getReferralBalance');
                        const res = await getBalance({});
                        if (res && res.data && referralBalanceEl) {
                            referralBalanceEl.textContent = (res.data.balance || 0).toString();
                        }
                    }
                } catch (e) {
                    // ÂøΩÁï•‰ΩôÈ¢ùËé∑ÂèñÂ§±Ë¥•
                }
                
            } catch (error) {
                console.error('Âä†ËΩΩÂ•ñÂà∏Â§±Ë¥•:', error);
                // Â¶ÇÊûúÂ§±Ë¥•ÔºåËÆæÁΩÆÈªòËÆ§ÂÄº
                if (currentUser) {
                    currentUser.ticketCount = 0;
                    updateUserInfo();
                }
            }
        }

        // Ë¥≠Á•®
        async function buyTicket(amount) {
            if (!wallet || !currentUser || !currentRound) {
                showNotification('ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ', 'error');
                return;
            }
            
            try {
                showLoading('Â§ÑÁêÜË¥≠Á•®‰∏≠...');
                
                // Ëé∑ÂèñÂΩìÂâç SOL ‰ª∑Ê†º
                await fetchSolPrice();
                
                // ËÆ°ÁÆóÈúÄË¶ÅÊîØ‰ªòÁöÑ SOL Êï∞Èáè
                const solAmount = amount / currentSolPrice;
                const lamports = convertUToLamports(amount);
                
                console.log(`${amount}U = ${solAmount.toFixed(4)} SOL (${lamports} lamports)`);
                
                // ÂàõÂª∫‰∫§Êòì
                const transaction = new solanaWeb3.Transaction();
                
                // ËøôÈáåÂ∫îËØ•ÂèëÈÄÅÂà∞‰Ω†ÁöÑÈ°πÁõÆÈí±ÂåÖÂú∞ÂùÄ
                const recipientAddress = new solanaWeb3.PublicKey('6N9GiSmCPDQBoLmGGdEF5RyTAu3osQFe4GTFJwFUEhKo');
                
                transaction.add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: wallet.publicKey,
                        toPubkey: recipientAddress,
                        lamports: lamports,
                    })
                );

                // Ëé∑ÂèñÊúÄÊñ∞ÁöÑ blockhash Âπ∂ËÆæÁΩÆ feePayerÔºàÂ∏¶ÈáçËØïÔºâ
                let blockhash, lastValidBlockHeight;
                for (let attempt = 0; attempt < 3; attempt++) {
                    try {
                        const blockhashResult = await connection.getLatestBlockhash('confirmed');
                        blockhash = blockhashResult.blockhash;
                        lastValidBlockHeight = blockhashResult.lastValidBlockHeight;
                        break;
                    } catch (e) {
                        if (attempt === 2) throw e;
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                }
                
                transaction.recentBlockhash = blockhash;
                transaction.feePayer = wallet.publicKey;

                // Á≠æÂêçÂπ∂ÂèëÈÄÅ‰∫§Êòì
                const signedTx = await wallet.signTransaction(transaction);
                const txid = await connection.sendRawTransaction(signedTx.serialize(), {
                    skipPreflight: false,
                    preflightCommitment: 'confirmed',
                    maxRetries: 5
                });
                
                // Á≠âÂæÖ‰∫§ÊòìÁ°ÆËÆ§ÔºàÁÆÄÂåñÁ°ÆËÆ§ÈÄªËæëÔºâ
                try {
                    await connection.confirmTransaction(txid, 'confirmed');
                } catch (confirmErr) {
                    console.warn('‰∫§ÊòìÁ°ÆËÆ§Ë∂ÖÊó∂Ôºå‰ΩÜ‰∫§ÊòìÂèØËÉΩÂ∑≤ÊàêÂäü:', confirmErr);
                    // ÁªßÁª≠ÊâßË°åÔºå‰∏çÂõ†‰∏∫Á°ÆËÆ§Ë∂ÖÊó∂ËÄåÂ§±Ë¥•
                }

                // ÂêéÁ´ØÊ†°È™åÂπ∂ËÆ∞ÂΩïË¥≠Á•®
                if (typeof firebase !== 'undefined' && firebase.functions) {
                    try {
                        const functionsClient = firebase.functions();
                        const record = firebase.app().functions().httpsCallable('recordPurchase');
                        await record({ amount, signature: txid, walletAddress: wallet.publicKey.toString(), referrer: referralReferrer });
                    } catch (fnErr) {
                        console.warn('‰∫ëÂáΩÊï∞ËÆ∞ÂΩïË¥≠Á•®Â§±Ë¥•ÔºåÂ∞ÜÂõûÈÄÄÂà∞ÂâçÁ´ØÂÜôÂÖ•:', fnErr);
                        await recordTicketPurchase(amount, txid);
                    }
                } else {
                    await recordTicketPurchase(amount, txid);
                }

                showNotification(`ÊàêÂäüË¥≠‰π∞ ${amount}U Â•ñÂà∏ÔºÅ(${solAmount.toFixed(4)} SOL)`, 'success');
                await loadUserTickets();
                await loadCurrentRound();
                
            } catch (error) {
                console.error('Ë¥≠Á•®Â§±Ë¥•:', error);
                showNotification('Ë¥≠Á•®Â§±Ë¥•ÔºåËØ∑ÈáçËØï', 'error');
            } finally {
                hideLoading();
            }
        }

        // ËÆ∞ÂΩïË¥≠Á•®
        async function recordTicketPurchase(amount, signature) {
            try {
                // Á°Æ‰øùÂ∑≤ËÆ§ËØÅ
                await ensureAuth();
                // ËÆ∞ÂΩïÂ•ñÂà∏
                await db.collection('tickets').add({
                    userId: currentUser.uid,
                    walletAddress: wallet.publicKey.toString(),
                    level: amount,
                    amount: amount,
                    transactionSignature: signature,
                    referrer: referralReferrer || null,
                    createdAt: new Date(),
                });

                // Êõ¥Êñ∞ËΩÆÊ¨°ÂèÇ‰∏éËÄÖ
                if (currentRound) {
                    try {
                        if (currentRound.id) {
                            const roundRef = db.collection('rounds').doc(currentRound.id);
                            const roundDoc = await roundRef.get();
                            if (roundDoc.exists) {
                                const roundData = roundDoc.data();
                                const newParticipants = [...(roundData.participants || []), {
                                    userId: currentUser.uid,
                                    walletAddress: wallet.publicKey.toString(),
                                    amount: amount,
                                    timestamp: new Date(),
                                }];
                                await roundRef.update({
                                    participants: newParticipants,
                                    totalAmount: (roundData.totalAmount || 0) + amount,
                                });
                                if (newParticipants.length >= 10) {
                                    await triggerLottery(roundRef.id);
                                }
                            }
                        }
                    } catch (e) {
                        console.warn('Êó†ÊùÉÈôêÊõ¥Êñ∞ËΩÆÊ¨°ÔºåÂ∞ÜÁ≠âÂæÖÂêéÂè∞Â§ÑÁêÜ:', e);
                    }
                }
            } catch (error) {
                console.error('ËÆ∞ÂΩïË¥≠Á•®Â§±Ë¥•:', error);
            }
        }

        // Ëß¶ÂèëÂºÄÂ•ñ
        async function triggerLottery(roundId) {
            // ÂâçÁ´Ø‰∏çÂÜçÁõ¥Êé•‰øÆÊîπËΩÆÊ¨°Áä∂ÊÄÅÔºå‰∫§Áî±‰∫ëÂáΩÊï∞/ÂêéÂè∞Â§ÑÁêÜ
            showNotification('ËΩÆÊ¨°Â∑≤Êª°ÂëòÔºåÁ≠âÂæÖÂêéÂè∞Ëá™Âä®ÂºÄÂ•ñ', 'info');
            await loadCurrentRound();
        }

        // Âä†ËΩΩÂ•ñÊ±†‰ø°ÊÅØ
        async function loadPoolInfo() {
            try {
                const grandPrizeDoc = await db.collection('pools').doc('grandPrize').get();
                const developerDoc = await db.collection('pools').doc('developer').get();
                
                const grandPrizeAmount = grandPrizeDoc.exists ? grandPrizeDoc.data().amount || 0 : 0;
                const developerAmount = developerDoc.exists ? developerDoc.data().amount || 0 : 0;
                
                const grandPrizeElement = document.getElementById('grand-prize');
                const developerPoolElement = document.getElementById('developer-pool');
                const totalTicketsElement = document.getElementById('total-tickets');
                
                if (grandPrizeElement) grandPrizeElement.textContent = grandPrizeAmount;
                if (developerPoolElement) developerPoolElement.textContent = developerAmount;
                
                // ËÆ°ÁÆóÊÄªÂ•ñÂà∏Êï∞ÔºàËøôÈáåÁÆÄÂåñÂ§ÑÁêÜÔºâ
                const ticketsQuery = await db.collection('lotteryTickets').where('used', '==', false).get();
                if (totalTicketsElement) totalTicketsElement.textContent = ticketsQuery.size;
                
            } catch (error) {
                console.error('Âä†ËΩΩÂ•ñÊ±†‰ø°ÊÅØÂ§±Ë¥•:', error);
            }
        }

        // ‰∫ã‰ª∂ÁõëÂê¨
        document.addEventListener('DOMContentLoaded', function() {
            // Ëß£Êûê URL Êé®Ëçê‰∫∫ÂèÇÊï∞
            try {
                const url = new URL(window.location.href);
                const ref = url.searchParams.get('ref');
                if (ref && typeof ref === 'string' && ref.length > 20) {
                    referralReferrer = ref;
                }
            } catch (_) {}

            // Èí±ÂåÖËøûÊé•ÊåâÈíÆ
            connectWalletBtn.addEventListener('click', () => {
                walletModal.classList.remove('hidden');
            });

            // È°µËÑöÈí±ÂåÖËøûÊé•ÊåâÈíÆ
            const footerWalletBtn = document.getElementById('footer-wallet-connect');
            if (footerWalletBtn) {
                footerWalletBtn.addEventListener('click', () => {
                    walletModal.classList.remove('hidden');
                });
            }

            // Êñ≠ÂºÄÈí±ÂåÖ
            disconnectWalletBtn.addEventListener('click', disconnectWallet);

            // Ë¥≠Á•®ÊåâÈíÆ
            buyTicketsBtn.addEventListener('click', () => {
                if (!wallet) {
                    showNotification('ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ', 'error');
                    return;
                }
                // ÊªöÂä®Âà∞Ë¥≠Á•®Âå∫Âüü
                document.querySelector('#ticket-levels').scrollIntoView({ behavior: 'smooth' });
            });

            // Ê®°ÊÄÅÊ°ÜÂÖ≥Èó≠
            closeModal.addEventListener('click', () => {
                walletModal.classList.add('hidden');
            });

            // ÊâìÂºÄÁé©Ê≥ïËØ¥Êòé
            const openRules = document.getElementById('open-rules');
            const rulesModal = document.getElementById('rules-modal');
            const closeRules = document.getElementById('close-rules');
            if (openRules && rulesModal && closeRules) {
                openRules.addEventListener('click', () => rulesModal.classList.remove('hidden'));
                closeRules.addEventListener('click', () => rulesModal.classList.add('hidden'));
                // ÁÇπÂáªÈÅÆÁΩ©ÂÖ≥Èó≠
                rulesModal.addEventListener('click', (e) => {
                    if (e.target === rulesModal) rulesModal.classList.add('hidden');
                });
            }

            // ÊâìÂºÄÂéÜÂè≤ËÆ∞ÂΩï
            const openHistoryBtn = document.getElementById('open-history');
            const historyModal = document.getElementById('history-modal');
            const closeHistory = document.getElementById('close-history');
            if (openHistoryBtn && historyModal && closeHistory) {
                openHistoryBtn.addEventListener('click', () => {
                    historyModal.classList.remove('hidden');
                });
                closeHistory.addEventListener('click', () => historyModal.classList.add('hidden'));
                // ÁÇπÂáªÈÅÆÁΩ©ÂÖ≥Èó≠
                historyModal.addEventListener('click', (e) => {
                    if (e.target === historyModal) historyModal.classList.add('hidden');
                });
            }

            // ÂºÄÂ•ñÁªìÊûúÂºπÁ™ó - ÂÖ≥Èó≠‰∏éÈÅÆÁΩ©ÁÇπÂáªÂÖ≥Èó≠
            if (closeDrawResult && drawResultModal) {
                closeDrawResult.addEventListener('click', () => drawResultModal.classList.add('hidden'));
                drawResultModal.addEventListener('click', (e) => {
                    if (e.target === drawResultModal) drawResultModal.classList.add('hidden');
                });
            }

            // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
            walletModal.addEventListener('click', (e) => {
                if (e.target === walletModal) {
                    walletModal.classList.add('hidden');
                }
            });

            // Èí±ÂåÖËøûÊé•ÊåâÈíÆ
            phantomConnect.addEventListener('click', () => connectWallet('phantom'));
            solflareConnect.addEventListener('click', () => connectWallet('solflare'));
            coinbaseConnect.addEventListener('click', () => connectWallet('coinbase'));

            // Ë¥≠Á•®ÊåâÈíÆ‰∫ã‰ª∂
            document.querySelectorAll('.buy-ticket-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const amount = parseInt(button.dataset.amount);
                    buyTicket(amount);
                });
            });

            // Â§çÂà∂ÈÇÄËØ∑ÈìæÊé•
            if (copyReferralLinkBtn && referralLinkInput) {
                copyReferralLinkBtn.addEventListener('click', async () => {
                    try {
                        if (!referralLinkInput.value) return;
                        await navigator.clipboard.writeText(referralLinkInput.value);
                        showNotification('ÈÇÄËØ∑ÈìæÊé•Â∑≤Â§çÂà∂', 'success');
                    } catch (e) {
                        showNotification('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂', 'error');
                    }
                });
            }

            // Âπ≥ÊªëÊªöÂä®
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });

            // ÁªôÂç°ÁâáÊ∑ªÂä†ÈöèÊú∫ÊóãËΩ¨ËßíÂ∫¶
            document.querySelectorAll('.rotate-random').forEach(el => {
                if (!el.style.getPropertyValue('--rotation')) {
                    const rotation = (Math.random() * 6) - 3;
                    el.style.setProperty('--rotation', `${rotation}deg`);
                }
            });

            // ÂàùÂßãÂåñÂä†ËΩΩ
            loadPoolInfo();
            // Á°Æ‰øùÊúâÊ¥ªÂä®ËΩÆÊ¨°ÔºàÈÄöËøá‰∫ëÂáΩÊï∞ÂàõÂª∫ÊàñËé∑ÂèñÔºâ
            (async () => {
                try {
                    if (typeof firebase !== 'undefined' && firebase.functions) {
                        const createOrGet = firebase.app().functions().httpsCallable('createOrGetActiveRound');
                        const res = await createOrGet({});
                        if (res && res.data) {
                            currentRound = { id: res.data.id, ...res.data };
                            updateRoundInfo(currentRound);
                            if (currentRound && currentRound.id) attachRoundListener(currentRound.id);
                        }
                    }
                } catch (e) {
                    console.warn('ÂàùÂßãÂåñÊ¥ªÂä®ËΩÆÊ¨°Â§±Ë¥•ÔºàÂ∞Ü‰æùËµñÂÆûÊó∂ÁõëÂê¨Ôºâ:', e);
                }
            })();
            // ÂàùÂßãÂåñSOL‰ª∑Ê†ºÊòæÁ§∫
            updateSolPriceDisplay();
            fetchSolPrice(); // ÂàùÂßãÂåñÊó∂Ë∞ÉÁî®Ëé∑Âèñ SOL ‰ª∑Ê†º
            
            // ÁõëÂê¨Èí±ÂåÖËøûÊé•Áä∂ÊÄÅ
            if (window.solana) {
                window.solana.on('connect', () => {
                    updateWalletUI();
                });
                
                window.solana.on('disconnect', () => {
                    disconnectWallet();
                });
            }
        });

        // ÂÆûÊó∂ÁõëÂê¨ËΩÆÊ¨°ÂèòÂåñ
        db.collection('rounds')
            .where('status', '==', 'active')
            .onSnapshot((snapshot) => {
                if (!snapshot.empty) {
                    const round = snapshot.docs[0];
                    currentRound = {
                        id: round.id,
                        ...round.data()
                    };
                    updateRoundInfo(currentRound);
                    if (currentRound && currentRound.id) attachRoundListener(currentRound.id);
                }
            });

        // ÂÆûÊó∂ÁõëÂê¨Â•ñÊ±†ÂèòÂåñ
        db.collection('pools').onSnapshot((snapshot) => {
            snapshot.docChanges().forEach((change) => {
                if (change.type === 'modified' || change.type === 'added') {
                    loadPoolInfo();
                }
            });
        });




    </script>
</body>
</html>
